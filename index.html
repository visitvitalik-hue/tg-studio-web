<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Content Master Command Center</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #050505; color: white; -webkit-tap-highlight-color: transparent; }
        
        .tab-btn { padding: 12px; flex: 1; text-align: center; border-bottom: 2px solid #222; color: #666; font-weight: 700; transition: all 0.3s; font-size: 12px; letter-spacing: 0.5px; }
        .tab-btn.active { border-bottom-color: #3B82F6; color: white; }
        .tab-btn.partner-tab.active { border-bottom-color: #F59E0B; color: #F59E0B; }
        .tab-btn.manual-tab.active { border-bottom-color: #10B981; color: #10B981; }

        .mode-card {
            background: #151515; border: 1px solid #262626; border-radius: 16px; padding: 12px;
            display: flex; flex-direction: column; gap: 8px; transition: all 0.2s; cursor: pointer;
        }
        .mode-card.active { border-color: #3B82F6; background: #1E293B; box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); }
        
        .video-container {
            width: 100%; height: 220px; background: #000; border-radius: 12px; 
            overflow: hidden; margin-bottom: 16px; border: 1px dashed #333;
            display: flex; align-items: center; justify-content: center; position: relative;
        }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        .btn-main {
            background: #3B82F6; width: 100%; padding: 16px; border-radius: 12px;
            font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
            position: fixed; bottom: 16px; left: 16px; right: 16px; width: calc(100% - 32px); z-index: 50;
        }
        
        .hidden { display: none !important; }
        
        .caption-input {
            background: #151515; border: 1px solid #262626; 
            border-radius: 12px; width: 100%; padding: 12px; 
            color: white; outline: none; font-size: 14px;
            transition: border-color 0.2s;
        }
        .caption-input:focus { border-color: #3B82F6; }

        /* Manual Styles */
        .manual-card {
            background: #111; border: 1px solid #333; border-radius: 12px; padding: 16px; margin-bottom: 12px;
        }
        .manual-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .manual-icon { font-size: 24px; }
        .manual-title { font-weight: 700; color: white; font-size: 16px; }
        .manual-desc { font-size: 13px; color: #aaa; line-height: 1.4; margin-bottom: 12px; }
        .manual-btn {
            background: #222; border: 1px solid #444; color: white; padding: 8px 16px; 
            border-radius: 8px; font-size: 12px; font-weight: 600; width: 100%; text-align: center;
        }
        
        /* Slider Styles */
        .settings-panel {
            background: #1E1E1E; border: 1px solid #333; border-radius: 12px; padding: 12px;
            margin-bottom: 16px; margin-top: -10px;
        }
        input[type=range] {
            width: 100%; -webkit-appearance: none; background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #3B82F6; cursor: pointer; margin-top: -6px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #444; border-radius: 2px;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- TAB NAVIGATION -->
    <div class="flex sticky top-0 bg-[#050505] z-50 border-b border-[#222]">
        <div class="tab-btn active" onclick="switchTab('video')">üé¨ MEDIA</div>
        <div class="tab-btn" onclick="switchTab('text')">‚úçÔ∏è TEXT</div>
        <div class="tab-btn partner-tab" onclick="switchTab('partner')">ü§ù PARTNER</div>
        <div class="tab-btn manual-tab" onclick="switchTab('manual')">‚ÑπÔ∏è MANUAL</div>
    </div>

    <!-- 1. SECTION: VIDEO STUDIO -->
    <div id="video-section" class="p-4 flex flex-col pb-24 overflow-y-auto">
        <div class="video-container" onclick="document.getElementById('videoInput').click()">
            <video id="previewPlayer" controls class="hidden"></video>
            <div id="uploadPlaceholder" class="text-center">
                <div class="text-4xl mb-3">üìÇ</div>
                <div class="text-sm font-bold text-gray-400">–ù–∞–∂–º–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
                <div class="text-xs text-gray-600 mt-1">MP4 / MOV –¥–æ 50MB</div>
            </div>
        </div>
        <input type="file" id="videoInput" accept="video/mp4,video/quicktime,video/webm,image/*" multiple style="display: none;" onchange="handleFileSelect(this)">

        <div class="mb-6">
            <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">–ü–æ–¥–ø–∏—Å—å (–¥–ª—è –≤–∏–¥–µ–æ)</h3>
            <textarea id="videoCaption" rows="2" class="caption-input" placeholder="–ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –∑–¥–µ—Å—å..."></textarea>
        </div>

        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3 ml-1">–†–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏</h3>
        
        <!-- Strip Settings (Hidden by default) -->
        <div id="stripSettings" class="settings-panel hidden">
            <div class="flex justify-between text-xs font-bold text-gray-300 mb-2">
                <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–µ–π:</span>
                <span id="stripCountVal" class="text-blue-400">10</span>
            </div>
            <input type="range" id="stripCount" min="1" max="20" value="10" oninput="updateStripVal(this.value)">
            <div class="flex justify-between text-[10px] text-gray-500 mt-1">
                <span>1</span>
                <span>20</span>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="mode-card" id="card-slideshow" onclick="selectVideoMode('slideshow', this)">
                <div class="text-2xl">üì∏</div>
                <div class="font-bold text-sm text-white">Slideshow</div>
                <div class="text-[10px] text-gray-500">–í–∏–¥–µ–æ –∏–∑ —Ñ–æ—Ç–æ</div>
            </div>

            <div class="mode-card active" id="card-circle" onclick="selectVideoMode('circle', this)">
                <div class="text-2xl">üîµ</div>
                <div class="font-bold text-sm text-white">Fake Live</div>
                <div class="text-[10px] text-gray-500">–ö—Ä—É–∂–æ—á–µ–∫</div>
            </div>
            
            <div class="mode-card" id="card-avatar" onclick="selectVideoMode('avatar', this)">
                <div class="text-2xl">üü£</div>
                <div class="font-bold text-sm text-white">Live Avatar</div>
                <div class="text-[10px] text-gray-500">–ü—Ä–æ—Ñ–∏–ª—å HQ</div>
            </div>

            <div class="mode-card" id="card-grid_3x3" onclick="selectVideoMode('grid_3x3', this)">
                <div class="text-2xl">üß©</div>
                <div class="font-bold text-sm text-white">–°–µ—Ç–∫–∞ 3x3</div>
                <div class="text-[10px] text-gray-500">–°—Ç–∏–∫–µ—Ä–ø–∞–∫</div>
            </div>
            
            <!-- NEW: DYNAMIC STRIP -->
            <div class="mode-card" id="card-strip" onclick="selectVideoMode('strip', this)">
                <div class="text-2xl">‚ûñ</div>
                <div class="font-bold text-sm text-white">–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –ü–æ–ª–æ—Å–∞</div>
                <div class="text-[10px] text-gray-500">–î–æ 20 —á–∞—Å—Ç–µ–π</div>
            </div>

            <div class="mode-card" id="card-fx_boomerang" onclick="selectVideoMode('fx_boomerang', this)">
                <div class="text-2xl">‚ôæÔ∏è</div>
                <div class="font-bold text-sm text-white">Boomerang</div>
                <div class="text-[10px] text-gray-500">–ó–∞–ª–∏–ø–∞–ª–æ–≤–æ</div>
            </div>
            <div class="mode-card" id="card-9_16" onclick="selectVideoMode('9_16', this)">
                <div class="text-2xl">üì±</div>
                <div class="font-bold text-sm text-white">Reels 9:16</div>
                <div class="text-[10px] text-gray-500">–î–ª—è Stories</div>
            </div>
            <div class="mode-card" id="card-16_9" onclick="selectVideoMode('16_9', this)">
                <div class="text-2xl">üñ•Ô∏è</div>
                <div class="font-bold text-sm text-white">Tube 16:9</div>
                <div class="text-[10px] text-gray-500">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å</div>
            </div>
            <div class="mode-card" id="card-fx_audio" onclick="selectVideoMode('fx_audio', this)">
                <div class="text-2xl">üéµ</div>
                <div class="font-bold text-sm text-white">MP3 Audio</div>
                <div class="text-[10px] text-gray-500">–í—ã—Ç–∞—â–∏—Ç—å –∑–≤—É–∫</div>
            </div>
        </div>

        <button class="btn-main" onclick="sendVideoTask()">–û–¢–ü–†–ê–í–ò–¢–¨ –í –†–ê–ë–û–¢–£</button>
    </div>

    <!-- 2. TEXT LAB -->
    <div id="text-section" class="p-4 hidden flex flex-col h-screen pb-24">
        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">–®–∞–±–ª–æ–Ω –ø–æ—Å—Ç–∞</h3>
        <div class="grid grid-cols-1 gap-2 mb-4 overflow-y-auto flex-grow pr-1" style="max-height: 50vh;">
            <div class="bg-[#111] border border-[#333] p-4 rounded-xl cursor-pointer hover:border-blue-500 transition active" onclick="selectTemplate('insider', this)">
                <div class="text-blue-400 font-bold text-sm">üïµÔ∏è The Insider</div>
                <div class="text-xs text-gray-500">–°–µ–∫—Ä–µ—Ç—ã, —Å–ª–∏–≤—ã, –∏–Ω—Å–∞–π–¥—ã</div>
            </div>
            <div class="bg-[#111] border border-[#333] p-4 rounded-xl cursor-pointer hover:border-blue-500 transition" onclick="selectTemplate('pov', this)">
                <div class="text-purple-400 font-bold text-sm">üëÅÔ∏è POV: Gen Z</div>
                <div class="text-xs text-gray-500">–ñ–∏–∑–∞, —Å–ª–µ–Ω–≥, –∫–æ—Ä–æ—Ç–∫–æ</div>
            </div>
             <div class="bg-[#111] border border-[#333] p-4 rounded-xl cursor-pointer hover:border-blue-500 transition" onclick="selectTemplate('story', this)">
                <div class="text-green-400 font-bold text-sm">üìñ Storyteller</div>
                <div class="text-xs text-gray-500">–ü—É—Ç—å –≥–µ—Ä–æ—è, –∫–µ–π—Å, –ø—Ä–æ–±–ª–µ–º–∞/—Ä–µ—à–µ–Ω–∏–µ</div>
            </div>
             <div class="bg-[#111] border border-[#333] p-4 rounded-xl cursor-pointer hover:border-blue-500 transition" onclick="selectTemplate('flash_sale', this)">
                <div class="text-amber-400 font-bold text-sm">‚ö° Flash Sale</div>
                <div class="text-xs text-gray-500">–°—Ä–æ—á–Ω–æ, —Å–∫–∏–¥–∫–∏, –¥–µ–¥–ª–∞–π–Ω</div>
            </div>
        </div>
        <div class="mt-4 pt-4 border-t border-[#222]">
            <textarea id="promptInput" rows="3" class="caption-input" placeholder="–¢–µ–º–∞ –ø–æ—Å—Ç–∞..."></textarea>
            <button class="btn-gen w-full mt-4 bg-emerald-500 text-black font-bold py-4 rounded-xl shadow-lg shadow-emerald-900/20" onclick="sendTextTask()">–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨</button>
        </div>
    </div>

    <!-- 3. PARTNER -->
    <div id="partner-section" class="p-4 hidden flex flex-col flex-grow">
        <div class="bg-gradient-to-br from-amber-900/20 to-black border border-amber-900/50 rounded-2xl p-6 text-center mb-6 relative overflow-hidden">
             <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-500 to-yellow-300"></div>
            <div class="text-4xl mb-2">üëë</div>
            <h2 class="text-xl font-bold text-amber-500 mb-1">–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –ö–ª—É–±</h2>
            <p class="text-xs text-gray-400">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π ‚Äî –ø–æ–ª—É—á–∞–π VIP –¥–æ—Å—Ç—É–ø</p>
        </div>
        
        <div class="bg-[#111] p-4 rounded-xl border border-[#222] mb-4">
            <div class="text-xs text-gray-500 uppercase font-bold mb-2">–¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</div>
            <div class="flex items-center gap-2 bg-black p-3 rounded-lg border border-[#333]">
                <code id="ref-link" class="text-xs text-blue-400 overflow-hidden text-ellipsis whitespace-nowrap w-full">loading...</code>
                <button onclick="copyLink()" class="text-gray-400 hover:text-white">üìã</button>
            </div>
        </div>
        <button class="btn-partner w-full mt-auto bg-amber-500 text-black font-bold py-4 rounded-xl shadow-lg shadow-amber-900/20" onclick="shareLink()">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê üöÄ</button>
    </div>

    <!-- 4. MANUAL -->
    <div id="manual-section" class="p-4 hidden flex flex-col pb-24 overflow-y-auto">
        <h2 class="text-xl font-bold text-white mb-4">–ì–∞–π–¥ –ø–æ —Ä–µ–∂–∏–º–∞–º</h2>

        <div class="manual-card">
            <div class="manual-header">
                <span class="manual-icon">üîµ</span>
                <span class="manual-title">Fake Live</span>
            </div>
            <p class="manual-desc">–î–µ–ª–∞–µ—Ç –∫—Ä—É–∂–æ—á–µ–∫ (video note) –∏–∑ –ª—é–±–æ–≥–æ –≤–∏–¥–µ–æ. <br>–í–Ω–∏–º–∞–Ω–∏–µ: –¢–µ–ª–µ–≥—Ä–∞–º —Å–∞–º —Å–∫—Ä—É–≥–ª—è–µ—Ç –∫—Ä–∞—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ.</p>
            <button class="manual-btn" onclick="quickSelect('circle')">–í–∫–ª—é—á–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–∂–∏–º</button>
        </div>

        <div class="manual-card">
            <div class="manual-header">
                <span class="manual-icon">üì∏</span>
                <span class="manual-title">–°–ª–∞–π–¥-—à–æ—É</span>
            </div>
            <p class="manual-desc">–°–æ–±–µ—Ä–∏ –≤–∏–¥–µ–æ –¥–ª—è Reels –∏–∑ —Å–≤–æ–∏—Ö —Ñ–æ—Ç–æ. <br>1. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É. <br>2. –ó–∞–≥—Ä—É–∑–∏ –¥–æ 10 —Ñ–æ—Ç–æ. <br>3. –ë–æ—Ç —Å–∞–º —Å–∫–ª–µ–∏—Ç –∏—Ö –ø–æ–¥ –º—É–∑—ã–∫—É.</p>
            <button class="manual-btn" onclick="quickSelect('slideshow')">–í–∫–ª—é—á–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–∂–∏–º</button>
        </div>

        <div class="manual-card">
            <div class="manual-header">
                <span class="manual-icon">‚ûñ</span>
                <span class="manual-title">–ü–æ–ª–æ—Å–∞ (Custom Strip)</span>
            </div>
            <p class="manual-desc">–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –Ω–∞—Ä–µ–∑–∫–∞. –í—ã–±–µ—Ä–∏ –æ—Ç 1 –¥–æ 20 —á–∞—Å—Ç–µ–π. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –±–∞–Ω–Ω–µ—Ä–æ–≤ –Ω–∞ –ü–ö.</p>
            <button class="manual-btn" onclick="quickSelect('strip')">–í–∫–ª—é—á–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–∂–∏–º</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#050505');
        tg.setBackgroundColor('#050505');

        const userId = tg.initDataUnsafe?.user?.id || 'unknown';
        const botUsername = 'you_tg_studio_bot';
        const refLink = `https://t.me/${botUsername}?start=${userId}`;

        document.getElementById('ref-link').innerText = refLink;
        
        let currentTab = 'video';
        let currentVideoMode = 'circle';
        let currentTemplate = 'insider';
        let stripCount = 10;

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            ['video', 'text', 'partner', 'manual'].forEach(t => {
                const el = document.getElementById(t + '-section');
                if(t === tab) el.classList.remove('hidden'); else el.classList.add('hidden');
            });
            haptic();
        }

        function quickSelect(mode) {
            switchTab('video');
            const card = document.getElementById('card-' + mode);
            if(card) selectVideoMode(mode, card);
            document.getElementById('video-section').scrollTop = 0;
        }

        function handleFileSelect(input) {
            const files = input.files;
            if (files.length > 0) {
                const file = files[0];
                const url = URL.createObjectURL(file);
                const player = document.getElementById('previewPlayer');
                
                if(file.type.startsWith('video')) {
                     player.src = url;
                     player.classList.remove('hidden');
                     document.getElementById('uploadPlaceholder').classList.add('hidden');
                } else {
                     document.getElementById('uploadPlaceholder').innerHTML = `<div class="text-green-400 text-4xl">‚úÖ</div><div class="text-sm font-bold text-white">–í—ã–±—Ä–∞–Ω–æ: ${files.length}</div>`;
                }
                haptic();
            }
        }

        function selectVideoMode(mode, el) {
            currentVideoMode = mode;
            document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            
            // Show/Hide Slider for Strip mode
            if(mode === 'strip') {
                document.getElementById('stripSettings').classList.remove('hidden');
            } else {
                document.getElementById('stripSettings').classList.add('hidden');
            }
            
            haptic();
        }

        function updateStripVal(val) {
            stripCount = val;
            document.getElementById('stripCountVal').innerText = val;
        }

        function sendVideoTask() {
            const caption = document.getElementById('videoCaption').value;
            // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º strip, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Ä–µ–∂–∏–º –≤ —Ñ–æ—Ä–º–∞—Ç grid_Nx1
            let modeToSend = currentVideoMode;
            if(modeToSend === 'strip') {
                modeToSend = `grid_${stripCount}x1`;
            }

            tg.sendData(JSON.stringify({ 
                type: 'video_setup', 
                mode: modeToSend,
                caption: caption 
            }));
        }

        function selectTemplate(tpl, el) {
            currentTemplate = tpl;
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('active')); // visual simplified
            haptic();
        }

        function sendTextTask() {
            const prompt = document.getElementById('promptInput').value;
            if (!prompt) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É!");
            tg.sendData(JSON.stringify({ type: 'text_gen', template: currentTemplate, prompt: prompt }));
        }

        function shareLink() {
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=${encodeURIComponent("üî• –ó–∞—Ü–µ–Ω–∏ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞!")}`);
        }

        function copyLink() {
            navigator.clipboard.writeText(refLink);
            tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
            haptic();
        }

        function haptic() {
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        }
    </script>
</body>
</html>